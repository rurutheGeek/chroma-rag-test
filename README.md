# DeepSeek & Chroma RAG チャットボット

このプロジェクトは、ローカルのドキュメント（PDF, TXT, JSONL）を読み込み、ChromaDBにベクトルストアを構築し、DeepSeek APIを利用して対話的な質疑応答（RAG）を行うPythonスクリプトです。

-----

## 概要

指定されたディレクトリ内のドキュメントを自動で読み込み、内容をベクトル化して永続的なデータベース（ChromaDB）に保存します。
起動後は、DeepSeekの大規模言語モデル（LLM）に対して、保存したドキュメントの内容に基づいた質問をすることができます。

-----

## 主な機能

  * **マルチフォーマット対応**: `data/input` ディレクトリ内の `.pdf`, `.txt`, `.jsonl` ファイルを自動で読み込みます。
  * **JSONL（Twitter）対応**: `.jsonl` ファイル（Twitterエクスポートデータなどを想定）から日付（`created_at`）と本文（`full_text`）を抽出し、ドキュメントとして取り込みます。
  * **高性能な埋め込み**: HuggingFaceの `intfloat/multilingual-e5-large` モデルを使用して、ドキュメントをベクトル化します（GPUが利用可能な場合は自動で使用）。
  * **永続ベクトルストア**: ベクトルデータは `.chroma` ディレクトリに永続化され、2回目以降の起動が高速になります。
  * **LLM連携**: DeepSeek API (deepseek-chat) と連携し、回答生成を行います。
  * **履歴の保存**: 実行された質問と回答、および参照されたソースドキュメントは、`data/output` にMarkdownファイルとして自動保存されます。

-----

## セットアップ

### 1\. ディレクトリ構造

プロジェクトを以下のディレクトリ構造でセットアップしてください。

```
.
├── .env                  # APIキーを格納
├── main.py               # メインスクリプト
├── requirements.txt      # 必要なライブラリ
│
├── data/
│   ├── input/            # ここにソースドキュメント (.pdf, .txt, .jsonl) を配置
│   │   └── (例) my_document.pdf
│   │
│   └── output/           # 質問と回答の履歴が .md として保存される
│
└── .chroma/              # (自動生成) ベクトルストア
```

### 2\. 必要なライブラリ (Requirements)

`requirements.txt` に記載されているライブラリが必要です。
以下のコマンドでライブラリをインストールします。

```bash
pip install -r requirements.txt
```

### 3\. 環境変数 (APIキー)

プロジェクトのルートディレクトリに `.env` ファイルを作成し、DeepSeek APIキーを設定します。

**`.env`**

```
DEEPSEEK_API_KEY=ここにあなたのAPIキーを貼り付け
```

### 4\. ソースドキュメントの配置

`data/input` ディレクトリに、RAGの知識源として使用したいファイル（.pdf, .txt, .jsonl）を配置してください。
このディレクトリにファイルが1つもない場合、スクリプトはエラーで停止します。

-----

## 実行方法

1.  ターミナルでスクリプトを実行します。

    ```bash
    python main.py
    ```

2.  **初回起動時**:
    `data/input` 内のドキュメントが読み込まれ、ベクトル化が開始されます。ドキュメントの量に応じて時間がかかる場合があります。
    「ベクトルストアへの登録完了」と表示されたら、データベースの構築は完了です。

3.  **2回目以降の起動時**:
    `.chroma` ディレクトリに保存された既存のデータベースを自動的に読み込みます。「既存のコレクション 'my\_collection' を使用します」と表示され、すぐにチャットが開始できます。

4.  **チャットの開始**:
    「質問を入力してください:」と表示されたら、コンソールに質問を入力します。

5.  **チャットの終了**:
    `quit` または `exit` と入力すると、チャットを終了します。

-----

## データベースの再構築

`data/input` の内容を変更・追加・削除した場合は、ベクトルストアを再構築する必要があります。
プロジェクトルートにある **`.chroma` ディレクトリ全体を削除**してから `python main.py` を実行してください。
（スクリプトは既存の `.chroma` ディレクトリを見つけると、ドキュメントの読み込みをスキップするため）