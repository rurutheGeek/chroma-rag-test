# 質問と回答

## 質問
大事なことはなんですか

## 回答
誤解されない名前をつけることが重要です。具体的には以下の点に注意してください：

- 名前が他の意味と間違えられないか自問自答する
- 限界値にはmax_/min_を使用する
- 包含的範囲にはfirst/lastを使用する
- 包含/排他的範囲にはbegin/endを使用する
- ブール値にはis/has/can/shouldなどをつけて明確にする
- 否定形ではなく肯定形を使用する
- ユーザが既に持っている期待（get()やsize()が軽量であるなど）に合わせる
- 複数の候補から最も誤解の少ない名前を選択する

名前はコードの意図を正確に伝え、誤解を招かないようにすることが最も重要です。

## 参照したソースドキュメント

### ソース 1
```
```

ではなく、肯定形にしたほうが声に出して読みやすい（それに短くて済む）。

```python

bool use_ssl = true;

```

## 3.7 ユーザの期待に合わせる

たとえ別の意味で使っていたとしても、ユーザが先入観を持っているために誤解を招いてしまうことがある。こういうときは「負けを認めて」、誤解されない名前に変えたほうがいい。

### 例：get

()

多くのプログラマは、getで始まるメソッドはメンバの値を返すだけの「軽量アクセサ」であるという規約に慣れ親しんでいる。この規約を守らなければ、誤解を招く可能性がある。

以下は、やってはいけない例だ。コードはJavaで書いている。

```java public class StatisticsCollector { public void addSample(double x) { ... } public double getMean() { // すべてのサンプルをイテレートして、total / num_samplesを返す。 } ... } ```

getMean()は過去のデータをすべてイテレートして、その場で平均値を計算する実装になっている。データが大量にあったらものすごいコストだ！そのことを知らないプログラマは、コストが高いとは思わずにgetMean()を呼び出してしまうだろう。コストの高さが事前にわかるように、このメソッドはcomputeMean()などの名前に変えるべきだろう（あるいは、コストの高くない実装に変えるべきだろう）。

### 例：list::size()

C++の標準ライブラリの例を挙げよう。以下のコードには見つけにくいバグが存在する。これが原因でサーバの速度がめちゃくちゃ遅くなったことがある。

```cpp void ShrinkList(list<Node>& list, int max_size) { while (list.size() > max_size) { FreeNode(list.back()); list.pop_back(); } } ```
```

### ソース 2
```
ここに使う仮引数の名前は何がいいだろうか？プログラミングの命名規約では、包含／排他的範囲にbeginとendを使うことが多い。

でも、endは少しあいまいだ。例えば、「本の終盤（the end of the book）を読んでいる」の「end」は包含的だ。残念ながら英語には「ちょうど最後の値を超えたところ」を意味する簡潔な言葉がない。

beginとendの対はイディオムになっている（少なくともC++の標準ライブラリではこれが使われている。また、配列がこのように「スライス」されることも多い）ので、これが最善の選択と言える。

## 3.6 ブール値の名前

ブール値の変数やブール値を返す関数の名前を選ぶときには、trueとfalseの意味を明確にしなければいけない。

以下は危険な例だ。

```python

bool read_password = true;

```

「read」をどう「読む」かになるけど（ギャグじゃないよ）、これには2つの解釈の仕方がある。

パスワードをこれから読み取る必要がある。

パスワードをすでに読み取っている。

ここでは「read」を避けるべきだろう。代わりに、need_passwordやuser_is_authenticatedを使ったほうがいい。

ブール値の変数名は、頭にis・has・can・shouldなどをつけてわかりやすくすることが多い。

例えば、SpaceLeft()という名前は数値を返すように聞こえる。ブール値を返したいのであれば、HasSpaceLeft()という名前にしたほうがいい。

それから、名前を否定形にするのは避けたほうがいい。例えば、

```python

bool disable_ssl = false;

```

ではなく、肯定形にしたほうが声に出して読みやすい（それに短くて済む）。

```python

bool use_ssl = true;

```

## 3.7 ユーザの期待に合わせる

たとえ別の意味で使っていたとしても、ユーザが先入観を持っているために誤解を招いてしまうことがある。こういうときは「負けを認めて」、誤解されない名前に変えたほうがいい。

### 例：get

()
```

### ソース 3
```
# 3章 誤解されない名前

前章では、名前に情報を詰め込むことについて触れた。本章では、また違った話題に触れたいと思う。それは「誤解される名前に気を付けろ」だ。

## 鍵となる考え

名前が「他の意味と間違えられることはないだろうか？」と何度も自問自答する。

ここではクリエイティブになって欲しい。積極的に「誤解」を探していくのだ。そうすれば変更が必要なあいまいな名前が見つかるだろう。

本章に登場する例では、誤解する可能性を「ひとりごと」で確認してから、名前を選ぶようにしている。

## 3.1 例：filter()

データベースの問い合わせ結果を処理するコードを書いているとしよう。

```python results = Database.all_objects.filter("year <= 2011") ```

このresultsには何が含まれているだろうか？

「year <= 2011」のオブジェクト

「year <= 2011」ではないオブジェクト

どちらかよくわからないのは、filterがあいまいな言葉だからだ。これでは「選択する」のか「除外する」のかわからない。filterという名前は避けるべきだ。簡単に誤解を招いてしまう。

「選択する」のであれば、select()にしたほうがいい。「除外する」のであれば、exclude()にしたほうがいい。

## 3.2 例：Clip(text, length)

段落の内容を切り抜く関数があるとしよう。

```python

# textの最後を切り落として、「...」をつける

def Clip(text, length):

...

```

Clip()の動作は2つ考えられる。

最後からlength文字を削除する（remove）

最大length文字まで切り詰める（truncate）

後者のような気もするけど、確実なことは言えない。読み手に疑問を抱かせるよりも、関数名をTruncate(text, length)に変えるほうがいい。

それから、lengthという名前もダメだ。max_lengthにしたほうが明確になる。

これで終わりじゃない。max_lengthもいろんな解釈ができる。

バイト数

文字数

単語数
```

### ソース 4
```
後者のような気もするけど、確実なことは言えない。読み手に疑問を抱かせるよりも、関数名をTruncate(text, length)に変えるほうがいい。

それから、lengthという名前もダメだ。max_lengthにしたほうが明確になる。

これで終わりじゃない。max_lengthもいろんな解釈ができる。

バイト数

文字数

単語数

前章で触れたように、ここでは名前に単位をつけたほうがいい。この場合は「文字数」を意味しているので、max_lengthではなくmax_charsにするといいだろう。

## 3.3 限界値を含めるときはminとmaxを使う

ショッピングカートには商品が10点までしか入らないとしよう。

```python

CART_TOO_BIG_LIMIT = 10

if shopping_cart.num_items() >= CART_TOO_BIG_LIMIT:

Error("カートにある商品数が多すぎます。")

```

このコードには古典的な「off

by

oneエラー」のバグがある。これを修正するには>=を>に変えればいい。

```python

if shopping_cart.num_items() > CART_TOO_BIG_LIMIT:

```

（あるいはCART_TOO_BIG_LIMITを11に変えてもいい。）だけど、ここでの根本的な問題は、CART_TOO_BIG_LIMITという名前があいまいなことだ。これでは「未満（限界値を含まない）」なのか「以下（限界値を含む）」なのかがわからない。

### アドバイス

限界値を明確にするには、名前の前にmax_やmin_をつけよう。

この場合は、MAX_ITEMS_IN_CARTという名前にするべきだ。こうすればコードがより明確になる。

```python

MAX_ITEMS_IN_CART = 10

if shopping_cart.num_items() > MAX_ITEMS_IN_CART:

Error("カートにある商品数が多すぎます。")

```

## 3.4 範囲を指定するときはfirstとlastを使う

```

a b c d

first last

```

「未満」と「以下」の例は他にもある。
```

### ソース 5
```
MAX_ITEMS_IN_CART = 10

if shopping_cart.num_items() > MAX_ITEMS_IN_CART:

Error("カートにある商品数が多すぎます。")

```

## 3.4 範囲を指定するときはfirstとlastを使う

```

a b c d

first last

```

「未満」と「以下」の例は他にもある。

```python

print integer_range(start=2, stop=4)

# これが印字するのは、[2,3]？　それとも[2,3,4]？（あるいはその他？）

```

startは適切な名前だ。でも、stopは複数の意味に解釈できる。

包含的な範囲を表すのであれば（終端を範囲に含めるのであれば）、firstとlastを使うのがいい。例えば、以下のようになる。

```python

set.PrintKeys(first="Bart", last="Maggie")

```

stopではなくlastを使えば、包含していることが明確になる。

意味的に「正しく聞こえる」のであれば、firstとlast以外にもminとmaxを使って包含的範囲を表すことができる。

## 3.5 包含／排他的範囲にはbeginとendを使う

包含／排他的な範囲は便利だ。例えば、10月16日に開催されたイベントをすべて印字したいとする。以下のように書くほうが、

```python PrintEventsInRange("OCT 16 12:00am", "OCT 17 12:00am") ```

以下のように書くよりも簡単だ。

```python PrintEventsInRange("OCT 16 12:00am", "OCT 16 11:59:59.9999pm") ```

ここに使う仮引数の名前は何がいいだろうか？プログラミングの命名規約では、包含／排他的範囲にbeginとendを使うことが多い。

でも、endは少しあいまいだ。例えば、「本の終盤（the end of the book）を読んでいる」の「end」は包含的だ。残念ながら英語には「ちょうど最後の値を超えたところ」を意味する簡潔な言葉がない。
```

### ソース 6
```
```cpp void ShrinkList(list<Node>& list, int max_size) { while (list.size() > max_size) { FreeNode(list.back()); list.pop_back(); } } ```

この「バグ」が発生しているのは、list.size()の計算量がO(n)であることを作者が知らなかったからだ。リンクトリストのノード数を事前計算をせずに順番にカウントしているので、ShrinkList()全体の計算量がO(n2)になっている。

このコードは技術的に「正しい」し、ユニットテストもすべて成功している。でも、要素数が100万個のリストをShrinkList()に渡したら、終了までに1時間以上かかってしまう！

「そんなの呼び出し側の責任だよ。事前にドキュメントをちゃんと読むべきだ」なんて思うかもしれない。もちろん君が正しい。でもこの場合は、list.sizeに時間がかかりすぎるのが問題だ。C++には他にもコンテナがあるけど、どれも一定時間で終了するsize()メソッドを持っている。

size()という名前がcountSize()やcountElements()だったら、このような問題は起きなかったはずだ。C++の標準ライブラリの作者は、vectorやmapなどのコンテナに合わせてメソッド名をsize()にしたのだと思う。でも、そのことが原因で、他のコンテナと同じ高速な操作と間違えられるようになってしまった。なお、最新のC++標準では、size()の計算量をO(1)にすることが定められている。

### ウィザードは誰だ？

OpenBSDをインストールしていたときのことだ。ディスクのフォーマット中に難解なメニューが表示されて、ディスクパラメータを選択せよと言われた。オプションには「ウィザードモード」があった。ユーザに優しいオプションが見つかったので、安心してそれを選んだ。すると、インストーラが終了して、プロンプトが表示された。ディスクフォーマットのコマンドを手入力せよと言っている。ここから脱出することもできなかった。「ウィザード」とは、ユーザ自身のことだったんだ！

## 3.8 例：複数の名前を検討する
```

### ソース 7
```
4. inherit

どの名前もぼくたちには適切に思える。新しい機能を追加したのは、ぼくたち自身だからだ。でも、この機能を知らない人が見たらどうなるかを想像しなければいけない。それぞれの名前を調べていこう。他の誰かが誤解する可能性を考えるんだ。

### 1. template

```yaml

experiment_id: 101

template: 100

...

```

templateにはいくつかの問題がある。まず、「これはテンプレートだ」なのか「このテンプレートを使っている」なのかがわかりにくい。次に、「テンプレート」という言葉は、抽象的なものに何かを「埋め込」んで、具体的なものにするために使うものだ。テンプレートに使う実験のことを「本物」の実験ではない抽象的なものと誤解する人がいるかもしれない。この状況でtemplateを使うには意味があいまいすぎるのだ。

### 2. reuse

```yaml

experiment_id: 101

reuse: 100

...

```

reuseは悪くない言葉だ。でも、文字だけを見ると「この実験は100回再利用できる」と誤解される可能性もある。名前をreuse_idに変えたほうがいいだろう。でも、reuse_id: 100のことを「この実験の再利用idは100だ」と誤解するユーザがいるかもしれない。

### 3. copy

```yaml

experiment_id: 101

copy: 100

...

```

copyはいい名前だ。でも、copy: 100だけでは、「この実験を100回コピーする」なのか「これは100回めのコピーだ」なのかがわからない。他の実験を参照している言葉だということを明確にするには、copy_experimentという名前に変えるといい。今までのところ、これが最善の名前だ。

### 4. inherit

```yaml

experiment_id: 101

inherit: 100

...

```
```

### ソース 8
```
## 3.8 例：複数の名前を検討する

名前を決めるときには、複数の候補を検討すると思う。最終的に決める前に、それぞれ長所について話し合うのが普通だ。以下の例は、この選考過程について示したものだ。

高トラフィックのウェブサイトでは、ウェブサイトの変更によってビジネスがどのくらい改善できるかを調べる「実験」をすることが多い。以下の例は、実験用の設定ファイルだ。

```yaml

experiment_id: 100

description: "フォントサイズを14ptに上げる"

traffic_fraction: 5%

...

```

設定ファイルには、属性と値のペアが15個ほど定義されている。同じような実験をするときには、設定ファイルの大部分をコピペしなくてはいけない。

```yaml

experiment_id: 101

description: "フォントサイズを13ptに上げる"

[以下、experiment_id 100と同じ]

```

既存の設定ファイルを他の実験でも使えるようにしたい（これは「プロトタイプ継承」パターンと呼ばれる手法だ）。そうすれば、以下のように書ける。

```yaml

experiment_id: 101

the_other_experiment_id_I_want_to_reuse: 100

[以下、変更が必要な情報だけ書き換える]

```

ここで考えなければいけないのは、「the_other_experiment_id_I_want_to_reuse（再利用したい実験のID）の名前を何にするか？」だ。

以下の4つの名前を検討してみよう。

1. template

2. reuse

3. copy

4. inherit

どの名前もぼくたちには適切に思える。新しい機能を追加したのは、ぼくたち自身だからだ。でも、この機能を知らない人が見たらどうなるかを想像しなければいけない。それぞれの名前を調べていこう。他の誰かが誤解する可能性を考えるんだ。

### 1. template

```yaml

experiment_id: 101

template: 100

...

```
```

### ソース 9
```
### 4. inherit

```yaml

experiment_id: 101

inherit: 100

...

```

inheritという言葉はプログラマにはなじみがある。何かを継承するというのは、新たに変更を加えるという意味だ。クラスを継承すれば、そのクラスのメソッドとメンバがすべて手に入り、それらを変更したり新しく追加したりできる。現実の世界で考えてみても、身内の財産を継承するというのは、その財産を自分で好きなように保有したり売却したりできるという意味だ。

ただし、他の実験から継承していることは明確にしておこう。名前をinherit_fromやinherit_from_experiment_idに変えるといいだろう。

以上の検討結果から、最善の名前はcopy_experimentとinherit_from_experiment_idということになった。その理由は、何が起きるかを明確に表していて、誤解を生む可能性が低いからだ。

## 3.9 まとめ

最善の名前とは、誤解されない名前である。つまり、君のコードを読んでいる人が、君の意図を正しく理解できるということだ。英語の単語は、filter・length・limitのように、プログラミングに使うには意味があいまいなものが多い。

名前を決める前に反対意見を考えるなどして、誤解されない名前かどうかを想像してみよう。最善の名前というのは、誤解されない名前である。

上下の限界値を決めるときには、max_やmin_を前につけるといい。包含的範囲であれば、firstやlastを使うといいだろう。包含／排他的範囲であれば、beginとendがイディオムなのでそれを使う。ブール値に名前をつけるときには、それがブール値だとわかるようにisやhasなどの単語を使う。disable_sslのような否定形は避ける。

単語に対するユーザの期待にも注意する。例えば、get()やsize()には軽量なメソッドが期待されている。
```

